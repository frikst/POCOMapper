version: '1.0.0.{build}'
image: Visual Studio 2017

branches:
    only:
        - master

clone_depth: 1
clone_folder: C:\projects\pocomapper

before_build:
    - cmd: dotnet --version
    - cmd: dotnet restore --verbosity m

build_script:
    - cmd: >-
        dotnet build -c Release POCOMapper

        dotnet build -c Release POCOMapper.Test

test_script:
    - ps: >-
        dotnet test -c Release --logger -f net40 "trx;LogFileName=testresult-net40.xml" POCOMapper.Test

        $testExitNet40 = $lastExitCode

        dotnet test -c Release --logger -f netcoreapp2.0 "trx;LogFileName=testresult-netcore.xml" POCOMapper.Test

        $testExitNetCore = $lastExitCode

        $wc = New-Object 'System.Net.WebClient'

        $wc.UploadFile("https://ci.appveyor.com/api/testresults/mstest/$($env:APPVEYOR_JOB_ID)", "C:\projects\pocomapper\POCOMapper.Test\TestResults\testresult-net40.xml")

        $wc.UploadFile("https://ci.appveyor.com/api/testresults/mstest/$($env:APPVEYOR_JOB_ID)", "C:\projects\pocomapper\POCOMapper.Test\TestResults\testresult-netcore.xml")

        if ($testExitNet40 -OR $testExitNetCore) {
            exit 1;
        }

deploy: off
